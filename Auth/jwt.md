
Объяснение работы JWT

## Обзор
JSON Web Token (JWT) используется для безопасной передачи информации между сторонами. Он состоит из трех частей:
1. **Header (Заголовок)**: Указывает тип токена (JWT) и алгоритм подписи (например, HS256).
2. **Payload (Полезная нагрузка)**: Содержит утверждения (данные пользователя и метаданные, такие как exp, userId и т.д.).
3. **Signature (Подпись)**: Обеспечивает целостность токена, создается с использованием заголовка, полезной нагрузки и секретного ключа.

### Структура JWT
<Header>.<Payload>.<Signature>

Каждая часть закодирована с использованием Base64Url.

---

## Пошаговый процесс работы

### 1. Регистрация (Sign Up)
1. Пользователь отправляет данные для регистрации (например, email, пароль) на **Authentication Server (AuthServer)**.
2. AuthServer хэширует пароль и сохраняет данные пользователя в базе данных.
3. На этом этапе JWT не генерируется.

### 2. Вход (Sign In)
1. Пользователь отправляет учетные данные (email, пароль) на AuthServer.
2. AuthServer проверяет учетные данные:
   - Проверяет, существует ли пользователь.
   - Проверяет правильность пароля.
3. Если данные верны, AuthServer генерирует **AccessToken (Токен доступа)** и опционально **RefreshToken (Токен обновления)**:
   - **Header**: { "alg": "HS256", "typ": "JWT" }
   - **Payload**: { "userId": "123", "role": "user", "exp": 1670000000 }
   - **Signature**: Подписан с использованием секретного ключа.
4. AuthServer отправляет токены клиенту.

### 3. Отправка запросов API клиентом
1. Клиент включает AccessToken в заголовок Authorization:

Authorization: Bearer <AccessToken>

2. Отправляет запрос на **Application Server (AppServer)**.

### 4. AppServer проверяет токен
1. AppServer извлекает AccessToken из заголовка.
2. Декодирует JWT в:
   - **Header (Заголовок)**
   - **Payload (Полезная нагрузка)**
   - **Signature (Подпись)**
3. Проверяет токен:
   - Пересчитывает подпись с использованием заголовка, полезной нагрузки и секретного ключа.
   - Сравнивает пересчитанную подпись с той, что в токене.
   - Проверяет утверждение exp, чтобы убедиться, что токен не истек.
4. Если токен действителен, обрабатывает запрос и отвечает.
5. Если токен недействителен, отклоняет запрос (например, 401 Unauthorized).

---

## Схема

1. **Вход и создание токена**:
[Пользователь] --> [AuthServer: Проверяет пользователя] --> [Генерирует JWT: Header + Payload + Signature]

2. **API запрос с токеном**:
[Пользователь] --> [AppServer: Проверяет JWT] --> [Обрабатывает API запрос]

---

## Ключевые концепции
- **SecretKey (Секретный ключ)**: Этот ключ известен только AuthServer и AppServer.
- **Base64Url Encoding (Base64Url кодирование)**: Кодирует данные, чтобы они были безопасны для URL и HTTP заголовков.
- **Self-Contained (Самодостаточность)**: JWT содержит все необходимые данные для проверки; в процессе проверки токена не требуется запрос к базе данных (кроме сложных случаев использования).
